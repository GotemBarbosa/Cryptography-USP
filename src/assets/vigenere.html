<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body topmargin="0">
    <h1>Demonstração cifra de Ginevere</h1>
    <form name="f1">
        <div id="texts">
            <label>text to encode: </label>
            <input type="text" name="t1" oninput="this.value = this.value.toUpperCase()"><br>
            <label>text to decode: </label>
            <input type="text" name="t2" oninput="this.value = this.value.toUpperCase()"><br>
            <label>key: </label>
            <input type="text" name="A0" oninput="this.value = this.value.toUpperCase()">
        </div>
        <p>
            <input type="button" value="Random Key" onclick=RandomKey();>
            <input type="button" value="Encode" onclick=Encode()>
            <input type="button" value="Decode" onclick=Decode()>
            <!-- <input type="button" value="Remove Spaces" onclick=RemoveSpaces()>
            <input type="button" value="Add Spaces" onclick=AddSpaces()>
            <select size="1" name="D1">
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
            </select> -->
            <br>
        </p>
        <hr>
        <b>
            <font color="firebrick">
                <div id="msg"></div>
            </font>
        </b>
    </form>
</body>
<script>
    //---------------------------------------------------------------------------
    function MSG(s) {
        document.querySelector("#msg").innerHTML = s;
    }
    var tcount = 0;
    //---------------------------------------------------------------------------
    function RandomKey() {
        len = Math.floor(Math.random() * 11);
        console.log(len);
        len = (len < 5) ? 5 : len; //se len for menor que 5, len vai ser 5
        k = "";
        for (i = 0; i < len; i++) {
            a = Math.floor(Math.random() * 26);
            k += String.fromCharCode(65 + a);
        }
        document.f1.A0.value = k;
    }
    //---------------------------------------------------------------------------
    // function RemoveSpaces() {
    //     enc = document.f1.t2.value;
    //     temp = "";
    //     X = 0;
    //     while (X < enc.length) {
    //         if (enc.charAt(X) != " ") temp += (enc.charAt(X));
    //         else
    //             if (enc.charAt(X) == " ") temp += "";
    //         X++;
    //     }
    //     document.f1.t2.value = temp.toUpperCase();
    // }
    //---------------------------------------------------------------------------
    // function AddSpaces() {
    //     RemoveSpaces();
    //     enc = document.f1.t2.value;

    //     temp1 = "";
    //     X = 0;
    //     ad = document.f1.D1.value;
    //     tes = 0;
    //     while (X < enc.length) {
    //         if (tes == ad) tes = 0;
    //         temp1 += (enc.charAt(X));
    //         tes++;
    //         if (tes == ad) temp1 += " ";
    //         X++;
    //     }
    //     document.f1.t2.value = temp1.toUpperCase();
    // }
    // //---------------------------------------------------------------------------
    function GetKeys() {
        m = new Array;
        a = (document.f1.A0.value.trim());
        if (a == "") {
            MSG("Invalid key " + a);
        }
        a = a.toUpperCase();
        document.f1.A0.value = a;
        for (var i = 0; i < a.length; i++) {
            m[i] = a.charCodeAt(i) - 65;
        }
        return m;
    }
    //---------------------------------------------------------------------------
    function Encode() {
        k = GetKeys();
        if (!k) {
            return;
        }
        enc = " " + document.f1.t1.value.toUpperCase();
        enc = (enc.trim());
        if (enc == "") {
            MSG("Enter some text to encode in 'Text to Encode' box!!");
            return;
        }
        kk = "<i> " + document.f1.A0.value + " </i>";
        mg = "<b>Message:</b><br><li>" + enc + "<br><br>Keys: " + kk + "<br> " +
            "<table border=1 cellpadding=3 cellspacing=0><tr>";

        for (var i = 0; i < k.length; i++) {
            mg += "<td> " + k[i];
        }
        mg += "</table><br><br><b>AS: </b><br><br><li>";
        d = "";
        cur = 0;
        for (var i = 0; i < enc.length; i++) {
            c = enc.charCodeAt(i);
            if (c < 'A'.charCodeAt(0) || c > 'Z'.charCodeAt(0)) {
                ch = enc.charAt(i);
                d += ch;
            }
            else {
                c = c - 65;
                t = (k[cur++ % k.length] + c) % 26;
                d += String.fromCharCode(65 + t);
            }
        }
        d = d.toLowerCase();
        mg += d;
        MSG(mg);
        document.f1.t2.value = d.toUpperCase();
    }
    //---------------------------------------------------------------------------
    function Decode(enc, k) {
        k1 = GetKeys();
        if (!k1) {
            return;
        }
        k = new Array;
        for (i = 0; i < k1.length; i++) {
            k[i] = (26 - k1[i]);
        }
        enc = document.f1.t2.value.toUpperCase();
        enc = (enc.trim());
        if (enc == "") {
            MSG("Enter some text to  in 'Text to Encode or Decode' box!!");
            return;
        }
        kk = "<i> " + document.f1.A0.value + " </i>";
        mg = "<b>Message:</b><br><li>" + enc + "<br><br>Keys: " + kk + "<br> " +
            "<table border=1 cellpadding=3 cellspacing=0><tr>";

        for (var i = 0; i < k.length; i++) {
            mg += "<td> " + k[i];
        }
        mg += "</table><br><br><b>AS: </b><br><br><li>";
        d = "";
        cur = 0;
        for (var i = 0; i < enc.length; i++) {
            c = enc.charCodeAt(i);
            if (c < 'A'.charCodeAt(0) || c > 'Z'.charCodeAt(0)) {
                ch = enc.charAt(i);
                d += ch;
            }
            else {
                c = c - 65;
                t = (k[cur++ % k.length] + c) % 26;
                d += String.fromCharCode(65 + t);
            }
        }
        d = d.toLowerCase();
        mg += d;
        MSG(mg);
        document.f1.t1.value = d.toUpperCase();
    }
//---------------------------------------------------------------------------
</script>
</html>